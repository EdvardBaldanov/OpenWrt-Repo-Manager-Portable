#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –ø–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
# –£–¥–∞–ª—è–µ—Ç –≤—Å–µ —Å–∫–∞—á–∞–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã, –∏–Ω–¥–µ–∫—Å—ã –∏ –ª–æ–≥–∏.

SCRIPT_DIR=$(cd "$(dirname "$0")" && pwd)
REPO_ROOT="/var/www/openwrt_repo"
LOG_FILE="$SCRIPT_DIR/update.log"

# –¶–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥
RED='\033[0;31m'
GREEN='\033[0;32m'
NC='\033[0m' # No Color

echo -e "${RED}‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï!${NC}"
echo "–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —É–¥–∞–ª–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤: $REPO_ROOT"
echo "–ë—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –≤—Å–µ .ipk —Ñ–∞–π–ª—ã, –∏–Ω–¥–µ–∫—Å—ã Packages –∏ –ª–æ–≥–∏."
echo ""
read -p "–í—ã —É–≤–µ—Ä–µ–Ω—ã? (y/N): " confirm

if [[ "$confirm" != "y" && "$confirm" != "Y" ]]; then
    echo "–û—Ç–º–µ–Ω–∞."
    exit 0
fi

echo ""
echo -e "üßπ [CLEAN] –û—á–∏—Å—Ç–∫–∞ –ø–∞–ø–∫–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è ${REPO_ROOT}..."
if [ -d "$REPO_ROOT" ]; then
    # –£–¥–∞–ª—è–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã –∏ –ø–∞–ø–∫–∏ –≤–Ω—É—Ç—Ä–∏ REPO_ROOT
    rm -rf "${REPO_ROOT:?}"/*
    echo "   ‚úÖ –ü–∞–ø–∫–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –æ—á–∏—â–µ–Ω–∞."
else
    echo "   ‚ö†Ô∏è –ü–∞–ø–∫–∞ $REPO_ROOT –Ω–µ –Ω–∞–π–¥–µ–Ω–∞."
fi

echo -e "üßπ [CLEAN] –£–¥–∞–ª–µ–Ω–∏–µ –ª–æ–≥-—Ñ–∞–π–ª–∞..."
if [ -f "$LOG_FILE" ]; then
    rm "$LOG_FILE"
    echo "   ‚úÖ –õ–æ–≥ $LOG_FILE —É–¥–∞–ª–µ–Ω."
else
    echo "   ‚ö†Ô∏è –õ–æ–≥-—Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω."
fi

echo ""
echo -e "${GREEN}‚ú® –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞.${NC}"
